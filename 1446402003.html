<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>IDF实验室 – 倒行逆至第五题 – breakpoint题解 - Vap0r's Blog</title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <link rel="icon" type="image/png" href="static/i/favicon.png">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="static/i/app-icon72x72@2x.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" href="static/i/app-icon72x72@2x.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="static/i/app-icon72x72@2x.png">
  <meta name="msapplication-TileColor" content="#0e90d2">

  <link rel="stylesheet" href="static/css/amazeui.min.css">
  <link rel="stylesheet" href="static/css/header.css">
  <link rel="stylesheet" href="static/css/footer.css">
  <link rel="stylesheet" href="static/css/single.css">
  <link rel="stylesheet" href="static/css/sidebar.css">	
</head>
<body>

<!--在这里编写你的代码-->

<div id="header">
	<a href="/">Vap0r's Blog</a>
</div>

<div class="am-g body">
	<div class="am-u-lg-7 am-u-lg-offset-3">
		<div id="menu" data-am-scrollspy-nav data-am-sticky>
	<a href="/">Home</a>
	<a href="about.htm">About</a>
</div>
		
		<div id="article">
			<div class="tags-icon am-icon-tag" id="tags">
				
					<span href="#">crackme</span> 
				
				<span id="date">2015/11/02</span>
			</div>		
			<div id="title">IDF实验室 – 倒行逆至第五题 – breakpoint题解</div>
			<div id="content">
				<p><a href="http://ctf.idf.cn/index.php?g=game&amp;m=article&amp;a=index&amp;id=46">题目传送门</a></p>
<p>0×01 初步分析:</p>
<p>首先是一个ELF程序,运行发现简单的提示输入,随便输入提示失败
题目名是断点,什么含义呢(看了下面才发现奇妙之处)</p>
<p>0×02 详细分析:</p>
<p>IDA载入程序,找到main入口地址0x80483b0</p>
<p>初步浏览框图发现底部是两个提示字符串,”You are wrong”和”You are right”,便可以确定核心代码就在0x80483b0到提示字符串之间</p>
<p>从头开始分析,IDA上图</p>
<p><img alt="IDA" src="http://senwordpress-wordpress.stor.sinaapp.com/uploads/2015/06/QQ%E6%88%AA%E5%9B%BE20150622012852.png"></p>
<p>可以看到下面循环为了计算一个值放入EAX, 注意到一个地方 该循环取80483b0 – 804872a之间的数据</p>
<p>注意到IDA流程图预览</p>
<p><img alt="IDA" src="http://senwordpress-wordpress.stor.sinaapp.com/uploads/2015/06/QQ%E6%88%AA%E5%9B%BE20150622024141.png"></p>
<p>中间有很多4 5句的小程序块,一个跳转成功就会提示失败</p>
<p>小程序快共16块, 分析可以知道在循环取EAX的每一字节来跟0×8049908 ~ 0×8049917直接数据异或值要等于0x80498F0 ~ 0x80498FF的值</p>
<p>大体算法很简单, 调试取得0x80498F0 ~ 0x80498FF的值,8049908 ~ 8049917又是我们的输入数据,长度16
问题来了,必须知道开始循环处的EAX值.
假如EAX = 0×12345678,就可以逆出我们应该输入的字符串,4位循环和0x80498F0 ~ 0x80498FF异或就可以得到
于是我调试到那一句,输出EAX值,果断写个程序逆计算出,但发现是不可见字符(肯定哪里不对了), 难道EAX值不对???
但我调试多次发现值一样但是却不对,偶然一次调试发现EAX值变了,尝试多次才想起来和题目名有关,下的断点位置数量不一样EAX都会不一样
正好GDB断点是软断点,会修改程序代码,刚好程序有”反调试”的功能,所以通过拔出0x80483b0 – 0x804872a的数据,手动计算出EAX应该是0x7eeb186f</p>
<p>后就可以跑出真的字符串了,代码在我Github可以找到,通关密码:WCTF{Br3akP0lnt}</p>
			</div>
		</div>
	</div>
</div>

<div id="footer">
	<p>&copy;2015 Vap0r's Blog.</p>
</div>

<!--[if (gte IE 9)|!(IE)]><!-->
<script src="static/js/jquery.min.js"></script>
<!--<![endif]-->
<!--[if lte IE 8 ]>
<script src="http://libs.baidu.com/jquery/1.11.3/jquery.min.js"></script>
<script src="http://cdn.staticfile.org/modernizr/2.8.3/modernizr.js"></script>
<script src="static/js/amazeui.ie8polyfill.min.js"></script>
<![endif]-->
<script src="static/js/amazeui.min.js"></script>
</body>
</html>