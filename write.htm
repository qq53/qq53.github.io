<!doctype html>
<html class="no-js">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="description" content="">
  <meta name="keywords" content="">
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <title>Write article</title>

  <!-- Set render engine for 360 browser -->
  <meta name="renderer" content="webkit">

  <!-- No Baidu Siteapp-->
  <meta http-equiv="Cache-Control" content="no-siteapp"/>

  <link rel="icon" type="image/png" href="templates/assets/i/favicon.png">

  <!-- Add to homescreen for Chrome on Android -->
  <meta name="mobile-web-app-capable" content="yes">
  <link rel="icon" sizes="192x192" href="templates/assets/i/app-icon72x72@2x.png">

  <!-- Add to homescreen for Safari on iOS -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <meta name="apple-mobile-web-app-title" content="Amaze UI"/>
  <link rel="apple-touch-icon-precomposed" href="templates/assets/i/app-icon72x72@2x.png">

  <!-- Tile icon for Win8 (144x144 + tile color) -->
  <meta name="msapplication-TileImage" content="templates/assets/i/app-icon72x72@2x.png">
  <meta name="msapplication-TileColor" content="#0e90d2">

  <link rel="stylesheet" href="templates/assets/css/amazeui.min.css">
  <link rel="stylesheet" href="templates/assets/css/write.css">
</head>
<body>

	<div>
		<div class="am-input-group">
		  <span class="am-input-group-label title-icon"><i class="am-icon-file-o am-icon-fw"></i></span>
		  <input type="text" id="title" class="am-form-field title" placeholder="标题">
		</div>
		<div class="am-input-group tags">
		  <span class="am-input-group-label"><i class="am-icon-paperclip am-icon-fw"></i></span>
		  <input id="tags"  type="text" class="am-form-field" placeholder="分类">
		</div>
		<div class="am-u-lg-6 preview" id="textarea">
			<textarea type="text" id="input" class="am-form-field preview-text" oninput="this.editor.update()" placeholder="内容"></textarea>
		</div>
		<div class="am-u-lg-6 preview">		
			<div id="output" class="preview-text">
			</div>
		</div>
		<button type="button" class="am-btn am-btn-default" id="export" onclick="saveArt()">导出</button>
	</div>
	
<script src="templates/assets/js/jquery.min.js"></script>
<script src="templates/assets/js/amazeui.min.js"></script>
<script src="templates/assets/js/parse.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		function Editor(input, preview){
			this.update = function () {
				preview.innerHTML = marked(input.value);
			return false;
			};
			input.editor = this;
			this.update();
		}
		$(window).mousemove(function(){
			$("#output").height( $('#textarea').height()-21 );		
		});
		new Editor($("#input")[0], $("#output")[0]);
	});
	function fake_click(obj) {
		var ev = document.createEvent("MouseEvents");
		ev.initMouseEvent(
			"click", true, false, window, 0, 0, 0, 0, 0
			, false, false, false, false, 0, null
			);
		obj.dispatchEvent(ev);
	}
	function export_raw(name, data) {
		var urlObject = window.URL || window.webkitURL || window;

		var export_blob = new Blob([data]);

		var save_link = document.createElementNS("http://www.w3.org/1999/xhtml", "a")
		save_link.href = urlObject.createObjectURL(export_blob);
		save_link.download = name;
		fake_click(save_link);
	}
	function saveArt(){
		fn = String( Math.floor(new Date().getTime()/1000) ) + '.json';
		
		t = $('#title').val()
		tg = $('#tags').val()
		c = encodeURI($('#input').val())
		
		json = '{"title":"' + t + '","tags":"' + tg + '","content":"' + c + '"}'
		
		export_raw(fn, json);
	}
</script>
</body>
</html>