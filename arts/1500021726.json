{"tags": "Exploit UserAfterFree", "title": "CVE-2015-0313\u5206\u6790", "content": "## 0x00.\u73af\u5883\r\n\u7cfb\u7edf:\uff1aWIN7 X86 SP1\r\n\r\n\u5f71\u54cd\u8f6f\u4ef6\uff1aflash_player_16.0.0.296\r\n\r\nEXP: [main.as](data/cve-2015-0313/main.as)\r\n\r\n## 0x01.\u6210\u56e0\r\nglobalMemory\u4e2dbyteArray\u91ca\u653e\u4f46\u8fd8\u4fdd\u7559\u4e86\u6307\u9488\uff0c\u4ece\u800c\u5bfc\u81f4UAF\r\n\r\n## 0x02.\u8981\u70b9\r\n\r\n1. \u4e3a\u4f55\u8981\u7528\u5230\u591a\u7ebf\u7a0b\uff1f\r\n \u4e0d\u7528\u591a\u7ebf\u7a0b\u548cMessageChannel\u7684\u8bdd\uff0c\u4e0b\u9762\u4ee3\u7801\u4f1a\u4e0d\u8d77\u4f5c\u7528\r\n```ActionScript3\r\n    ApplicationDomain.currentDomain.domainMemory = ba   // \u8bbe\u7f6eba\u4e3a\u5168\u5c40\u5185\u5b58\u53ef\u8bbf\u95ee\r\n```\r\n\r\n2. \u4e0b\u9762\u4ee3\u7801\u4ec0\u4e48\u4f5c\u7528?\r\n```ActionScript3\r\n    ov[i][0] = ba\r\n    ov[i][1] = this\r\n```\r\n\u7528\u6765\u540e\u9762\u6cc4\u6f0fvtable\u548c\u65b0\u7684byteArray\u7528\r\n\r\n3. \u4e3a\u4ec0\u4e48Ojbect\u957f\u5ea6\u662f1014\uff0c\u800cuint\u662f1022?\r\n```ActionScript3\r\nov[i] = new Vector.<Object>(1014)   // 1014=0x3f6\r\nov[0] = new Vector.<uint>(1022)  // 1022=0x3FE\r\n```\r\nVector.<Object>\u524d\u67090x28\u88ab\u7528\uff0c\u800cVector.<uint>\u524d\u67098\u5b57\u8282\u5907\u7528\uff0c\u5408\u8d77\u6765\u90fd\u662f0x1000\r\n\r\n4. \u4e3a\u4f55\u8981\u5728OnMessage\u51fd\u6570\u4e2d\u8bbe\u7f6ebuffer\u957f\u5ea6\uff1f\r\n```ActionScript3\r\ncasi32(0, 1022, 0xFFFFFFFF) // ba\u957f\u5ea6\u88ab\u4fee\u6539\u4e3a0xFFFFFFF\r\n```\r\n\u8981\u786e\u4fdd\u6267\u884c\u987a\u5e8f\uff0c\u4fdd\u8bc10x1000\u7684Buffer\u843d\u5728\u4e4b\u524d\u91ca\u653e\u7684Vector.<Object>\u4e2d\r\n\r\n5. \u4ee3\u7801\u4e2d\u591a\u6b21\u51fa\u73b0-1\u662f\u4e3a\u4ec0\u4e48\uff1f\r\nAtom\u4f5c\u4e3aActionScipt\u4e2d\u539f\u5b50\u7c7b\u578b\uff0c\u89c4\u5b9a\u4e86\u6700\u4f4e3\u4f4d\u7684\u4f7f\u7528\r\n```ActionScript3\r\n     *      32 bit atom\r\n     *\r\n     *  31             16 15     8 7   3 210\r\n     *  dddddddd dddddddd dddddddd ddddd TTT\r\n     *\r\n     *  TTT\r\n     *  000  - untagged\r\n     *  001  object\r\n     *  010  string\r\n     *  011  namespace\r\n     *  100  undefined\r\n     *  101  boolean\r\n     *  110  integer\r\n     *  111  double\r\n```\r\n001\u521a\u597d\u4ee3\u8868object\r\n\r\n"}