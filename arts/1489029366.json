{"content": "\u521a\u63a5\u89e6EXP\uff0c\u6b22\u8fce\u6307\u6b63\u9519\u8bef\u3002\r\n\r\n# 1. \u76f8\u5173\u4fe1\u606f\r\n### \u53d7\u5f71\u54cd\u8f6f\u4ef6\uff1aAdobe Reader 8.2.4 - 9.3.4\r\n### \u76f8\u5173\u8d44\u6e90:\r\n\u751f\u6210POC\u811a\u672c(\u4fee\u6539\u5df2\u4e0d\u518d\u4f9d\u8d56Metasploit):  [adobe_cooltype_sing.rb](data/cve-2010-2883/adobe_cooltype_sing.rb)\r\n\r\n\u6240\u9700TTF\u6587\u4ef6:  [cve-2010-2883.ttf](data/cve-2010-2883/cve-2010-2883.ttf)\r\n### \u6f0f\u6d1e\u6210\u56e0: strcat\u5bfc\u81f4\u6808\u8986\u76d6this\u6307\u9488\uff0c\u63a7\u5236\u865a\u51fd\u6570\u8868\r\n\r\n# 2. POC\u5206\u6790\r\n\r\n\u9020\u6210\u6808\u6ea2\u51fa\u95ee\u9898\u51fa\u5728strcat\u8c03\u7528,\u4f4d\u4e8e0x806CD76\r\n```c\r\nsub_8021ABE(&TableEntry, a1, \"SING\");\r\nv6 = TableEntry;\r\nLOBYTE(v24) = 2;\r\nif ( TableEntry )\r\n{\r\n  if ( !(*&TableEntry->tableVersionMajor & 0xFFFF) || (*&TableEntry->tableVersionMajor & 0xFFFF) == 256 )\r\n  {\r\n    uniqueName = 0;\r\n    strcat(&uniqueName, TableEntry->uniqueName);\r\n    sub_8001243(a2, &uniqueName);\r\n    v6 = TableEntry;\r\n  }\r\n  v23 = 1;\r\n}\r\n```\r\n\u53ef\u4ee5\u770b\u5230\u5728\u89e3\u6790SING\u8868\uff0c\u540e\u7ecf\u8fc7\u4e00\u4e9b\u6761\u4ef6\u5c31\u4f1a\u6267\u884c\u5230strcat\u3002\u7531\u4e8e\u9664\u4e86ATL.DLL\u5176\u4ed6\u6a21\u5757\u5747\u5f00\u542f\u4e86SAFESEH\uff0c\u800cATL.DLL\u4e2d\u6211\u6ca1\u627e\u5230\u597d\u7528\u7684gadget\uff0c\u6240\u4ee5\u5229\u7528SEH\u63a7\u5236\u7a0b\u5e8f\u5f88\u96be\uff1f\uff08\u6211\u7684\u731c\u6d4b\uff09\r\n\r\nsub_8001243\u4f1a\u5bf9\u6211\u4eec\u8986\u76d6\u7684\u6808\u4e2d\u4e00\u4e2a\u5730\u5740addr+0x1c\u8fdb\u884c\u8bfb\u5199\uff0c\u6b64\u65f6\r\n```c\r\nuniqueName   = 12e4d8\r\na2 = 12e608  = uniqueName + 0x130 = sing + 0x140\r\n```\r\n\u5bf9\u5e94POC\u4ee3\u7801\r\n```ruby\r\n# 0xffffffff gets written here @ 0x7001400 (in BIB.dll)\r\nsing[0x140, 4] = [0x4a8a08e2 - 0x1c].pack('V')\r\n```\r\n\u968f\u540e\u8c03\u7528\r\n```x86asm\r\nsub_8016B96 -> sub_801BAD9 -> call dword ptr [eax]\r\n```\r\n\u6b64\u65f6 eax = 12e6e0 = sing + 0x240\r\n\r\n\u5bf9\u5e94POC\r\n```ruby\r\n# This becomes our new EIP (puts esp to stack buffer)\r\nret = 0x4a80cb38 # add ebp, 0x794 / leave / ret\r\nsing[0x208, 4] = [ret].pack('V')\r\n```\r\n\u5269\u4e0b\u7684\u6784\u9020SING\u8868POC\u5c31\u5f88\u597d\u7406\u89e3\u4e86\uff0c\u5176\u4e2d\u8bbe\u7f6eESP\u6307\u54110x0c0c0c0c\uff08PDF\u4e2dJS\u8d1f\u8d23\u5b8c\u6210\u5806\u55b7\uff09\r\n\r\n{style=\"color:#888;\"}\u6bd4\u8f83\u597d\u5947\u7684\u662fPOC\u4e2d\u8fd9\u6bb5\u4ee3\u7801\uff0c\u5728\u6211\u6d4b\u8bd5\u4e2d\u6ca1\u53d1\u73b0\u6709\u4ec0\u4e48\u7528\u5904\uff1f\uff1f\r\n```ruby\r\n# Without the following, sub_801ba57 returns 0.\r\nsing[0x24c, 4] = [0x6c].pack('V')\r\n```", "title": "CVE-2010-2883\u5206\u6790", "tags": "Exploit StackOverFlow"}